<!DOCTYPE html>
<html lang="de" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revierverwaltung | Rheiner Zoo</title>

    <div th:insert="~{vorlagen/icon :: icon}"></div>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/styles.css}">

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f9;
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        .card {
            border: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        .btn-primary, .btn-danger {
            color: white;
        }
    </style>
</head>

<body>

<!-- Sidebar -->
<div th:insert="~{vorlagen/sidebar :: sidebar}"></div>

<!-- Main Content -->
<div class="main-content">
    <div th:replace="~{vorlagen/header :: header(pageTitle='Revier Verwaltung - Rheiner Zoo')}"></div>

    <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#addRevierModal">
        <i class="fas fa-plus"></i> Revier hinzufügen
    </button>

    <!-- Tabelle -->
    <div class="card mt-3">
        <h4>Revierübersicht</h4>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Gebäude</th>
                <th>Aktionen</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="revier : ${revierList}">
                <td th:text="${revier.id}"></td>
                <td th:text="${revier.name}"></td>
                <td>
                    <span th:each="gebäude, iterStat : ${revier.gebaeude}" th:text="${gebäude.name + (iterStat.last ? '' : ', ')}"></span>
                </td>
                <td>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                            Aktionen
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item edit-btn" href="#"
                                   onclick="openEditModal(this)"
                                   th:data-id="${revier.id}"
                                   th:data-name="${revier.name}">
                                    <i class="fas fa-edit"></i> Bearbeiten
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item delete-btn" href="#"
                                   th:data-id="${revier.id}"
                                   onclick="deleteRevier(this)">
                                    <i class="fas fa-trash"></i> Löschen
                                </a>
                            </li>
                        </ul>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Modal: Neues Revier -->
    <div class="modal fade" id="addRevierModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Neues Revier hinzufügen</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addRevierForm">
                        <label>Reviername</label>
                        <input type="text" class="form-control mb-3" id="addRevierName" required>
                        <button type="submit" class="btn btn-success">Hinzufügen</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Revier bearbeiten -->
    <div class="modal fade" id="editRevierModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Revier bearbeiten</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editRevierForm">
                        <input type="hidden" id="editRevierId">
                        <label>Reviername</label>
                        <input type="text" class="form-control mb-3" id="editRevierName" required>
                        <button type="submit" class="btn btn-primary">Speichern</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function openEditModal(button) {
        document.getElementById("editRevierId").value = button.getAttribute("data-id");
        document.getElementById("editRevierName").value = button.getAttribute("data-name");
        new bootstrap.Modal(document.getElementById("editRevierModal")).show();
    }

    async function deleteRevier(button) {
        const id = button.getAttribute("data-id");
        if (!confirm("Möchtest du dieses Revier wirklich löschen?")) return;

        const response = await fetch("/api/revier/delete", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id })
        });

        if (response.ok) {
            alert("✅ Revier erfolgreich gelöscht!");
            location.reload();
        } else {
            alert("❌ Fehler beim Löschen des Reviers!");
        }
    }

    document.getElementById("addRevierForm").addEventListener("submit", async function(event) {
        event.preventDefault();
        const name = document.getElementById("addRevierName").value;

        const response = await fetch("/api/revier/add", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name })
        });

        if (response.ok) {
            alert("✅ Revier erfolgreich hinzugefügt!");
            location.reload();
        } else {
            alert("❌ Fehler beim Hinzufügen des Reviers!");
        }
    });

    document.getElementById("editRevierForm").addEventListener("submit", async function(event) {
        event.preventDefault();
        const id = document.getElementById("editRevierId").value;
        const name = document.getElementById("editRevierName").value;

        const response = await fetch("/api/revier/edit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id, name })
        });

        if (response.ok) {
            alert("✅ Revier erfolgreich bearbeitet!");
            location.reload();
        } else {
            alert("❌ Fehler beim Bearbeiten des Reviers!");
        }
    });
</script>

</body>
</html>
