<!DOCTYPE html>
<html lang="de" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lieferant hinzuf√ºgen</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url('/images/background.png');
            margin: 0;
            padding: 0;
            background-color: #f4f6f9;
            overflow-x: hidden;
        }

        .main-content.collapsed {
            margin-left: 70px;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .header {
            background-color: #1f4e3e;
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-control {
            margin-bottom: 15px;
        }

        .btn-primary {
            background-color: #218838;
            border: none;
        }

        .btn-primary:hover {
            background-color: #18672a;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

<div class="main-content" id="main-content">
    <div class="header">
        <h2><i class="fas fa-truck"></i> Neuer Lieferant</h2>
    </div>

    <form id="addLieferantForm">
        <!-- Name -->
        <label for="name" class="form-label">üìå Name</label>
        <input type="text" class="form-control" id="name" required>

        <!-- Adresse -->
        <label for="adresse" class="form-label">üìç Adresse</label>
        <select class="form-select" id="adresse" name="adresse" onchange="toggleNeueAdresse()" required>
            <option value="" disabled selected>W√§hle eine Adresse</option>
            <option th:each="adresse : ${adressen}"
                    th:value="${adresse.id}"
                    th:text="${adresse.strasse} + ' ' + ${adresse.hausnummer} + ', ' + ${adresse.ort.plz} + ' ' + ${adresse.ort.ortname}">
            </option>
            <option value="neu">Neue Adresse hinzuf√ºgen</option>
        </select>

        <!-- Neue Adresse Felder -->
        <div id="neueAdresseContainer" class="hidden mt-3">
            <h5>Neue Adresse eingeben</h5>
            <input type="text" id="strasse" class="form-control" placeholder="Stra√üe">
            <input type="text" id="hausnummer" class="form-control" placeholder="Hausnummer">
            <input type="text" id="plz" class="form-control" placeholder="PLZ">
            <input type="text" id="ortname" class="form-control" placeholder="Ort">
        </div>

        <!-- Telefon -->
        <label for="telefon" class="form-label">üìû Telefon</label>
        <input type="text" class="form-control" id="telefon" required>

        <!-- Ansprechpartner -->
        <label for="ansprechpartner" class="form-label">üë§ Ansprechpartner</label>
        <input type="text" class="form-control" id="ansprechpartner" required>

        <!-- Buttons -->
        <div class="mt-4 d-flex justify-content-between">
            <a href="/lieferanten" class="btn btn-secondary">üîô Abbrechen</a>
            <button type="submit" class="btn btn-primary">üíæ Hinzuf√ºgen</button>
        </div>
    </form>

    <div id="feedbackMessage" class="mt-3"></div>
</div>

<script>
    function toggleNeueAdresse() {
        const adresseDropdown = document.getElementById('adresse');
        const neueAdresseContainer = document.getElementById('neueAdresseContainer');
        neueAdresseContainer.style.display = adresseDropdown.value === 'neu' ? 'block' : 'none';
    }

    document.getElementById('addLieferantForm').addEventListener('submit', async function (event) {
        event.preventDefault();

        let payload = {
            name: document.getElementById('name').value.trim(),
            telefon: document.getElementById('telefon').value.trim(),
            ansprechpartner: document.getElementById('ansprechpartner').value.trim()
        };

        // Falls eine neue Adresse hinzugef√ºgt wird
        if (document.getElementById('adresse').value === 'neu') {
            payload.adresse = {
                strasse: document.getElementById('strasse').value.trim(),
                hausnummer: document.getElementById('hausnummer').value.trim(),
                plz: document.getElementById('plz').value.trim(),
                ortname: document.getElementById('ortname').value.trim()
            };
        } else {
            payload.adresseId = document.getElementById('adresse').value;
        }

        // √úberpr√ºfung, ob alle Felder ausgef√ºllt wurden
        if (!payload.name || !payload.telefon || !payload.ansprechpartner || (!payload.adresse && !payload.adresseId)) {
            document.getElementById("feedbackMessage").innerHTML = `
                <div class="alert alert-danger">‚ö†Ô∏è Bitte f√ºllen Sie alle Felder aus.</div>`;
            return;
        }

        try {
            const response = await axios.post('/api/lieferant/add', payload);
            if (response.status === 200) {
                document.getElementById("feedbackMessage").innerHTML = `
                    <div class="alert alert-success">‚úÖ Lieferant erfolgreich hinzugef√ºgt!</div>`;
                document.getElementById("addLieferantForm").reset();
            } else {
                throw new Error('Fehler beim Speichern.');
            }
        } catch (error) {
            document.getElementById("feedbackMessage").innerHTML = `
                <div class="alert alert-danger">‚ö†Ô∏è Fehler: ${error.message}</div>`;
        }
    });
</script>

</body>
</html>
