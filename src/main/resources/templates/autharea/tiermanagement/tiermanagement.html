
<!DOCTYPE html>
<html lang="de" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tierverwaltung | Rheiner Zoo</title>

  <div th:insert="~{vorlagen/icon :: icon}"></div>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" th:href="@{/css/styles.css}">

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f9;
    }
    .main-content {
      margin-left: 250px;
      padding: 20px;
    }
    .card {
      border: none;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    .btn-primary, .btn-danger {
      color: white;
    }
  </style>
</head>

<body>

<!-- Sidebar -->
<div th:insert="~{vorlagen/sidebar :: sidebar}"></div>

<!-- Main Content -->
<div class="main-content">
  <div th:replace="~{vorlagen/header :: header(pageTitle='Tierverwaltung - Rheiner Zoo')}"></div>

  <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#addTierModal">
    <i class="fas fa-plus"></i> Tier hinzuf√ºgen
  </button>

  <!-- Suchfeld -->
  <div class="mt-3">
    <label for="searchInput"></label><input type="text" id="searchInput" class="form-control" placeholder="Tier suchen..." onkeyup="filterTable()">
  </div>

  <!-- Tabelle -->
  <div class="card mt-3">
    <h4>Tier√ºbersicht</h4>
    <table class="table table-bordered">
      <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Geburtsdatum</th>
        <th>Geschlecht</th>
        <th>Tierart</th>
        <th>Revier</th>
        <th>Aktionen</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="tier : ${tiere}">
        <td th:text="${tier.id}"></td>
        <td th:text="${tier.name}"></td>
        <td th:text="${#temporals.format(tier.geburtsdatum, 'dd.MM.yyyy')}"></td>
        <td th:text="${tier.geschlecht}"></td>
        <td th:text="${tier.tierArt.name}"></td>
        <td th:text="${tier.revier.name}"></td>
        <td>
          <div class="btn-group">
            <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
              Aktionen
            </button>
            <ul class="dropdown-menu">
              <li>
                <a class="dropdown-item edit-btn" href="#" onclick="openEditModal(this)"
                   th:data-id="${tier.id}"
                   th:data-name="${tier.name}"
                   th:data-geburtsdatum="${tier.geburtsdatum}"
                   th:data-geschlecht="${tier.geschlecht}"
                   th:data-tierart="${tier.tierArt.name}"
                   th:data-revier="${tier.revier.name}">
                  <i class="fas fa-edit"></i> Bearbeiten
                </a>
              </li>
              <li>
                <a class="dropdown-item delete-btn" href="#" th:data-id="${tier.id}" onclick="deleteTier(this)">
                  <i class="fas fa-trash"></i> L√∂schen
                </a>
              </li>
            </ul>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal: Tier hinzuf√ºgen -->
  <div class="modal fade" id="addTierModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Neues Tier hinzuf√ºgen</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="addTierForm">
            <label>Name</label>
            <input type="text" class="form-control mb-3" id="addName" required>
            <label>Geburtsdatum</label>
            <input type="date" class="form-control mb-3" id="addGeburtsdatum" required>
            <label>Geschlecht</label>
            <select class="form-control mb-3" id="addGeschlecht" required>
              <option value="M√ÑNNLICH">M√§nnlich</option>
              <option value="WEIBLICH">Weiblich</option>
            </select>

            <label>Tierart</label>
            <select class="form-control mb-3" id="addTierart" required>
              <option th:each="tierart : ${tierarten}" th:value="${tierart.name}" th:text="${tierart.name}"></option>
              <option value="new">+ Neue Tierart hinzuf√ºgen...</option>
            </select>

            <label>Revier</label>
            <select class="form-control mb-3" id="addRevier" required>
              <option th:each="revier : ${reviere}" th:value="${revier.name}" th:text="${revier.name}"></option>
              <option value="new">+ Neues Revier hinzuf√ºgen...</option>
            </select>

            <button type="submit" class="btn btn-success">Hinzuf√ºgen</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal f√ºr neue Tierart -->
  <div class="modal fade" id="newTierartModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Neue Tierart hinzuf√ºgen</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="text" class="form-control mb-3" id="newTierartName" placeholder="Tierart eingeben">
          <button class="btn btn-success" onclick="saveNewTierart()">Speichern</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal f√ºr neues Revier -->
  <div class="modal fade" id="newRevierModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Neues Revier hinzuf√ºgen</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="text" class="form-control mb-3" id="newRevierName" placeholder="Revier eingeben">
          <button class="btn btn-success" onclick="saveNewRevier()">Speichern</button>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    console.log("‚úÖ JavaScript geladen!");

    // Pr√ºfen, ob Bootstrap geladen wurde
    if (typeof bootstrap === "undefined") {
      console.error("‚ùå Bootstrap JS fehlt!");
      alert("Bootstrap JS fehlt! Stelle sicher, dass es geladen ist.");
      return;
    }

    // Event-Listener f√ºr Tierart-Dropdown
    const addTierart = document.getElementById("addTierart");
    if (addTierart) {
      addTierart.addEventListener("change", function() {
        if (this.value === "new") {
          console.log("üì¢ Tierart-Modal wird ge√∂ffnet...");
          const modal = new bootstrap.Modal(document.getElementById("newTierartModal"));
          modal.show();
          this.value = "";
        }
      });
    } else {
      console.error("‚ùå addTierart nicht gefunden!");
    }

    // Event-Listener f√ºr Revier-Dropdown
    const addRevier = document.getElementById("addRevier");
    if (addRevier) {
      addRevier.addEventListener("change", function() {
        if (this.value === "new") {
          console.log("üì¢ Revier-Modal wird ge√∂ffnet...");
          const modal = new bootstrap.Modal(document.getElementById("newRevierModal"));
          modal.show();
          this.value = "";
        }
      });
    } else {
      console.error("‚ùå addRevier nicht gefunden!");
    }
  });


</script>

</body>
</html>
